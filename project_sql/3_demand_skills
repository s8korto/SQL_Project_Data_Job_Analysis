/*
Identify the most in-demand skills for the highest paying job title in the dataset
Why? This analysis helps job seekers understand which skills are most sought after for top-paying Data Scientist roles, enabling them to tailor their skillset to meet market demands
*/

-- Calculate top paying Data Scientist jobs with respective skills companies are looking for 
WITH top_paying_jobs AS (
SELECT 
    job_postings_fact.job_id,
    company_dim.name AS company_name,
    job_postings_fact.job_title,
    job_postings_fact.salary_year_avg
FROM 
    job_postings_fact
LEFT JOIN company_dim 
    ON job_postings_fact.company_id = company_dim.company_id
WHERE 
    job_postings_fact.salary_year_avg IS NOT NULL 
    AND job_postings_fact.job_title_short = 'Data Scientist'
ORDER BY 
    job_postings_fact.salary_year_avg DESC
LIMIT 15
), 

-- List skills associated with these top paying jobs
skills_dim AS 
(
SELECT 
    top_paying_jobs.job_id,
    top_paying_jobs.company_name,
    top_paying_jobs.job_title,
    skills_dim.skills
FROM   
    top_paying_jobs
LEFT JOIN skills_job_dim
    ON top_paying_jobs.job_id = skills_job_dim.job_id
LEFT JOIN skills_dim
    ON skills_job_dim.skill_id = skills_dim.skill_id
ORDER BY 
    salary_year_avg DESC
)
-- Count the demand for each skill in these top paying Data Scientist jobs
SELECT 
    skills_dim.skills,
    COUNT(skills_dim.skills) AS demand_count 
FROM 
    skills_dim
GROUP BY 
    skills_dim.skills
ORDER BY 
    demand_count DESC;